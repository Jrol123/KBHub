{% extends "base.html" %}

{% block css %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/form_styles.css') }}">
{% endblock %}

{% block content %}
    <div class="user-profile-info">
        <div class="user-info-container">
            <span class="user-avatar">
                {% if user.avatar %}
                    <img src="{{ url_for('static', filename= user.avatar) }}" alt="{{ user.name }}" class="author-avatar">
                {% endif %}
            </span>
            <div class="post-body">
                <span class="user-name">{{ user.name }}</span>
                <div>{{ user.bio }}</div>   <!--class="post-body"-->
            </div>
        </div>
        
        <div class="posts-container">
            <span class="user-name" style="text-align: center;">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏</span>
            {% if posts %}
                {% for post in posts %}
                <div class="post-card">
                    <a href="{{ url_for('post', post_id=post.id) }}" class="post-link-overlay"></a>
                    
                    {% if post.image %}
                    <div class="post-image-wrapper">
                        <img src="{{ url_for('static', filename= post.image) }}" 
                            alt="{{ post.title }}" 
                            class="post-image"
                            loading="lazy">
                    </div>
                    {% endif %}
                    
                    <div class="post-content-wrapper">
                        <h2 class="post-title">{{ post.title }}</h2>
                        <p class="post-excerpt">{{ post.excerpt }}</p>
                        
                        <div class="post-footer">
                            <div class="post-meta-right">
                                <span class="post-date">{{ post.date }}</span>
                                <span class="reading-time">
                                    <i class="far fa-clock"></i> {{ post.reading_time }} –º–∏–Ω
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p> –ù–∏—á–µ–≥–æ –ø–æ–∫–∞ –Ω–µ –Ω–∞–ø–∏—Å–∞–Ω–æ... </p>
            {% endif %}
        </div>
        {% if current_user.is_authenticated and current_user.id == user.id %}
            <div class="create-post-section">
                <button id="showPostForm" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</button>
                
                <form id="postForm" method="POST" action="{{ url_for('create_post') }}" enctype="multipart/form-data" style="display:none;">
                    <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</h3>
                    
                    <div class="form-group">
                        <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                        <input type="text" class="form-control" id="title" name="title" required maxlength="50">
                    </div>
                    
                    <div class="form-group">
                        <label for="excerpt">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="excerpt" name="excerpt" rows="2" required maxlength="150"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="content">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="content" name="content" rows="5" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <div class="file-upload-wrapper">
                            <button type="button" class="file-upload-button">
                                <span class="file-icon">üìÅ</span>
                                <span>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                            </button>
                            <input type="file" class="form-control-file" id="image" name="image" accept="image/*">
                        </div>
                        <span class="file-name-display" id="file-name">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="reading_time">–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è (–º–∏–Ω—É—Ç—ã)</label>
                        <input type="number" class="form-control" id="reading_time" name="reading_time" min="1" max="120" required>
                    </div>
                    
                    <button type="submit" class="btn btn-success">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                </form>
            </div>

            <script>
                document.getElementById('showPostForm').addEventListener('click', function() {
                    const form = document.getElementById('postForm');
                    form.style.display = form.style.display === 'none' ? 'block' : 'none';
                });
                document.getElementById('image').addEventListener('change', function(e) {
                    const fileName = this.files.length ? this.files[0].name : '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω';
                    document.getElementById('file-name').textContent = fileName;
                });
            </script>
        {% endif %}        
    </div>
{% endblock %}
